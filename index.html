<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<meta name="color-scheme" content="dark">
<meta name="theme-color" content="#0b1a27">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<title>CGA GÃ¼venlik Sistemleri - GiriÅŸ Paneli</title>

<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="logo.png">

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">

<style>
:root {
  color-scheme: dark;
  --cga-bg-main: #0b1a27;
  --cga-bg-secondary: #1a2b3f;
  --cga-gold: #f1c40f;
  --cga-gold-soft: rgba(241,196,15,0.35);
  --cga-green: #2ecc71;
  --cga-green-dark: #27ae60;
  --cga-text-main: #ecf0f1;
  --cga-text-soft: rgba(236,240,241,0.65);
  --cga-card-bg: rgba(255,255,255,0.06);
  --cga-border-soft: rgba(255,255,255,0.12);
}

html, body {
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
  overflow: hidden;
  font-family: 'Montserrat', sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  background: radial-gradient(circle at top, rgba(241,196,15,0.08), transparent 40%),
              linear-gradient(135deg, var(--cga-bg-main), var(--cga-bg-secondary));
  color: var(--cga-text-main);
}

/* PWA YÃ¼kle Butonu Modern Stil */
#installBtn {
  position: fixed;
  top: 20px;
  left: 20px;
  padding: 10px 18px;
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid var(--cga-border-soft);
  backdrop-filter: blur(10px);
  color: white;
  border-radius: 12px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  display: none; /* VarsayÄ±lan gizli */
  z-index: 1000;
  transition: 0.3s;
  align-items: center;
  gap: 8px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}
#installBtn:hover { background: rgba(255, 255, 255, 0.2); transform: scale(1.05); }

.container {
  width: 380px;
  padding: 40px 30px 70px;
  border-radius: 26px;
  background: var(--cga-card-bg);
  backdrop-filter: blur(22px);
  box-shadow: 0 0 0 1px var(--cga-border-soft), 0 20px 50px rgba(0,0,0,0.7);
  text-align: center;
  transform: translateY(-20px);
}

.cga-logo { width: 450px; max-width: 80%; margin: 20px auto 0; cursor: pointer; transition: 0.3s; }
.cga-logo:active { transform: scale(0.98); }

.site-name {
  display: none;
  font-size: 28px;
  font-weight: 800;
  letter-spacing: 1px;
  margin: 1px 0 18px;
  color: #2ecc71;
  text-shadow: 0 0 10px rgba(46,204,113,0.6);
  animation: glowIn .6s ease;
}

@keyframes glowIn { from { opacity: 0; transform: translateY(-6px); } to { opacity: 1; transform: translateY(0); } }

.role-buttons { display: flex; justify-content: center; margin-bottom: 25px; }
.role-buttons button {
  width: 100%;
  padding: 12px;
  border: none;
  border-radius: 15px;
  font-weight: 700;
  background: linear-gradient(90deg, var(--cga-gold), #f39c12);
  color: #111;
  box-shadow: 0 0 18px var(--cga-gold-soft);
}

.input-group { display: flex; flex-direction: column; text-align: left; margin-bottom: 28px; }

input[type="text"], input[type="password"] {
  width: 100%; padding: 12px; margin: 8px 0; border-radius: 12px; border: none;
  background: rgba(255, 255, 255, 0.1); color: white; font-size: 14px; outline: none;
  border: 1px solid transparent; transition: 0.3s;
}
input:focus { border-color: var(--cga-gold); background: rgba(255, 255, 255, 0.15); }

.remember { display: flex; align-items: center; gap: 8px; font-size: 14px; margin-top: 8px; }
.remember input { cursor: pointer; }

.loginBtn {
  width: 100%; padding: 14px; margin-top: 8px; border: none; border-radius: 16px;
  background: linear-gradient(90deg, var(--cga-green-dark), var(--cga-green));
  color: white; font-weight: 700; font-size: 16px; cursor: pointer;
  box-shadow: 0 6px 20px rgba(46,204,113,0.45); transition: 0.25s;
}
.loginBtn:hover { transform: translateY(-2px); filter: brightness(1.1); }

.message { margin-top: 15px; color: #e74c3c; font-weight: 600; text-align: center; min-height: 20px; }

.modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); align-items: center; justify-content: center; z-index: 2000; backdrop-filter: blur(5px); }
.modal-content { background: #1a2b3f; padding: 30px; border-radius: 24px; width: 320px; text-align: center; border: 1px solid var(--cga-border-soft); }

.corner-top { position: fixed; top: 15px; right: 15px; font-size: 10px; color: var(--cga-text-soft); }
.corner-bottom { position: fixed; bottom: 15px; right: 15px; font-size: 11px; color: var(--cga-text-soft); }

* { -webkit-tap-highlight-color: transparent; }
</style>
</head>
<body>

<button id="installBtn">ðŸ“² UygulamayÄ± YÃ¼kle</button>

<div class="container">
  <img src="logo.png" class="cga-logo" alt="CGA Logo">
  <div id="siteName" class="site-name"></div>
  <h2 style="font-size: 18px; margin-bottom: 25px;">GiriÅŸ Paneli</h2>

  <div class="role-buttons">
    <button id="securityBtn">ÅžÄ°RKET GÄ°RÄ°ÅžÄ°</button>
  </div>

  <div id="securityGroup" class="input-group">
    <input type="text" id="secUsername" placeholder="KULLANICI ADI" spellcheck="false">
    <input type="password" id="secPassword" placeholder="ÅžÄ°FRE">
    <div class="remember">
      <input type="checkbox" id="secRemember">
      <label for="secRemember">KullanÄ±cÄ±yÄ± hatÄ±rla</label>
    </div>
    <button class="loginBtn" id="secLoginBtn">GiriÅŸ Yap</button>
  </div>

  <div class="message" id="message"></div>
</div>

<div class="modal" id="adminModal">
  <div class="modal-content">
    <h3 style="color:var(--cga-gold); margin-top:0;">YÃ¶netici GiriÅŸi</h3>
    <input type="text" id="adminUsername" placeholder="KULLANICI ADI">
    <input type="password" id="adminPassword" placeholder="ÅžÄ°FRE">
    <button id="adminLoginBtn" class="loginBtn">GiriÅŸ Yap</button>
    <button id="closeAdminBtn" style="background:transparent; border:none; color:var(--cga-text-soft); margin-top:15px; cursor:pointer;">VazgeÃ§</button>
  </div>
</div>

<div class="corner-bottom">Â© 2025 CGA GÃ¼venlik Sistemleri</div>
<div class="corner-top">v1.0.0</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAUjb4CBSZxjCTxpx8S_rGLOLDeRtDTs7U",
  authDomain: "bencga-db51b.firebaseapp.com",
  databaseURL: "https://bencga-db51b-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "bencga-db51b",
  storageBucket: "bencga-db51b.firebasestorage.app",
  messagingSenderId: "568702678520",
  appId: "1:568702678520:web:82d3c6a98216990fa3d20d",
  measurementId: "G-703BGXWTFN"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// DOM Elements
const siteNameEl = document.getElementById("siteName");
const cgaLogo = document.querySelector(".cga-logo");
const msg = document.getElementById("message");
const adminModal = document.getElementById("adminModal");
const secUsername = document.getElementById("secUsername");
const secPassword = document.getElementById("secPassword");
const secRemember = document.getElementById("secRemember");
const adminUsername = document.getElementById("adminUsername");
const adminPassword = document.getElementById("adminPassword");
const installBtn = document.getElementById('installBtn');

// PWA MANTIÄžI
let deferredPrompt;
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  installBtn.style.display = 'flex'; 
});

installBtn.addEventListener('click', async () => {
  if (deferredPrompt) {
    deferredPrompt.prompt();
    const { outcome } = await deferredPrompt.userChoice;
    if (outcome === 'accepted') {
      console.log('KullanÄ±cÄ± yÃ¼klemeyi kabul etti');
    }
    deferredPrompt = null;
    installBtn.style.display = 'none';
  }
});

// Service Worker KaydÄ±
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js').catch(err => console.log("SW hatasÄ±:", err));
  });
}

// Admin Panel Tetikleyici (10 TÄ±klama)
let clickCount = 0;
cgaLogo.addEventListener("click", () => {
  clickCount++;
  if (clickCount >= 10) {
    adminModal.style.display = "flex";
    clickCount = 0;
  }
});
document.getElementById("closeAdminBtn").addEventListener("click", () => adminModal.style.display = "none");

// KullanÄ±cÄ± HatÄ±rlama
window.addEventListener("load", () => {
  const stored = JSON.parse(localStorage.getItem("securityUser"));
  if (stored) {
    secUsername.value = stored.username;
    secPassword.value = stored.password;
    secRemember.checked = true;
  }
  loadSiteName();
});

// BÃ¼yÃ¼k Harf DÃ¶nÃ¼ÅŸtÃ¼rÃ¼cÃ¼
[secUsername, adminUsername].forEach(el => {
  el.addEventListener("input", () => { el.value = el.value.toLocaleUpperCase('tr'); });
});

// Login Fonksiyonu
async function loginUser(username, password, role) {
  username = username.trim();
  password = password.trim();
  msg.textContent = "";

  if (!username || !password) {
    msg.textContent = "AlanlarÄ± doldurunuz!";
    return;
  }

  try {
    // Admin KontrolÃ¼
    const adminSnap = await get(child(ref(db), 'admin'));
    if (adminSnap.exists()) {
      const adm = adminSnap.val();
      if (username === adm.username && password === adm.password) {
        sessionStorage.setItem("currentUser", JSON.stringify({ username, type: "admin" }));
        window.location.href = "mod.html";
        return;
      }
    }

    // KullanÄ±cÄ± KontrolÃ¼
    const userSnap = await get(child(ref(db), 'users/' + username));
    if (!userSnap.exists()) {
      msg.textContent = "KullanÄ±cÄ± bulunamadÄ±!";
      return;
    }

    const user = userSnap.val();
    if (user.password !== password) {
      msg.textContent = "Åžifre hatalÄ±!";
      return;
    }

    // HatÄ±rla KontrolÃ¼
    if (role === "security") {
      if (secRemember.checked) localStorage.setItem("securityUser", JSON.stringify({ username, password }));
      else localStorage.removeItem("securityUser");
    }

    sessionStorage.setItem("currentUser", JSON.stringify({ username: user.username, type: user.type }));

    // YÃ¶nlendirme
    const routes = { "company": "sirket.html", "security": "guvenlik.html", "admin": "yetkili.html" };
    if (routes[user.type]) {
      window.location.href = routes[user.type];
    } else {
      msg.textContent = "Yetki hatasÄ±!";
    }

  } catch (err) {
    msg.textContent = "BaÄŸlantÄ± hatasÄ±!";
  }
}

// Buton OlaylarÄ±
document.getElementById("secLoginBtn").addEventListener("click", () => loginUser(secUsername.value, secPassword.value, "security"));
document.getElementById("adminLoginBtn").addEventListener("click", () => loginUser(adminUsername.value, adminPassword.value, "admin"));

// Enter TuÅŸu
document.addEventListener("keydown", (e) => {
  if (e.key === "Enter") {
    if (adminModal.style.display === "flex") document.getElementById("adminLoginBtn").click();
    else document.getElementById("secLoginBtn").click();
  }
});

async function loadSiteName() {
  try {
    const snap = await get(child(ref(db), "settings/siteName"));
    if (snap.exists() && snap.val().trim() !== "") {
      siteNameEl.textContent = snap.val();
      siteNameEl.style.display = "block";
    }
  } catch (e) {}
}
</script>

</body>
</html>
